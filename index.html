<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Bookmarklet generator for URL rotation</title>
    <style>
body {
    margin: 2% auto auto;
    max-width: 50em;
    font-family: sans-serif;
}
label, fieldset input, output {
    display: block;
    margin: 1em 0;
}
form, #instructions {
    float: left;
    width: 40%;
    margin-left: 2em;
}
ul.examples {
    display: inline-block;
    z-index: 1000;
    background: white;
    color: black;
    border: 1px solid lightgray;
    padding: 5px;
    margin-left: 2em;
}
ul.examples li{
    display: block;
}
[hidden=true] {
    display: none;
}

    </style>
</head>
<h1>Bookmarklet generator for URL rotation</h1>
<p><i>Rotate between different versions of a website by changing the URL.</i></p>
<form>
    <label>Bookmark title: <input id="bookmark-title" placeholder="Rotate!"></label>
    <fieldset>
        <legend>Strings</legend>
        <input class="needle" value="en_US">
        <input class="needle" value="de_DE">
        <input class="needle" value="fr_FR">
        <input class="needle" value="ja_JP">
        <input class="needle" value="zh_CN">
        <button type="button">+</button>
    </fieldset>
    <input type="submit" value="Generate bookmarklet">
    <output hidden="true">Drag me or copy me: <a href="#"></a></output>
</form>

<div id="instructions">
    <p>This will generate a bookmarklet that replaces a string in the list with the next string:</p>
    <ul class="examples">
        <li><a href="#">www.example.com</a></li>
        <li><a href="#">stage.example.com</a></li>
        <li><a href="#">example.local</a></li>
    </ul>
    <p>... will take you to the exact same page on another domain. Or replace a query string value with the next one:</p>
    <ul class="examples">
        <li><a href="#">locale=en_US</a></li>
        <li><a href="#">locale=en_XA</a></li>
        <li><a href="#">locale=fr_FR</a></li>
    </ul>
    <p>Each time you click the bookmarklet, the next value will be pushed into the URL and the page will be reloaded.</p>
</div>
<script>
function generateBookmarklet(e) {
    e.preventDefault();
    var needles = [];
    var needlesInput = document.querySelectorAll('input.needle');
    for (var i=0, il=needlesInput.length; i<il; i++) {
        var needle = needlesInput[i].value;
        if (needle.length > 0) {
            needles.push('"' + needle + '"');
        }
    }
    needleArray= '[' + needles.join(',') + ']';

    // generate bookmark string
    var bookmarklet = 'javascript:(function(){var strs=' + needleArray + ',\
loc=window.location;\
for(var i=0;i<strs.length;i++){\
  var pos=loc.href.indexOf(strs[i]);\
  if(pos>=0){\
    j=((i+1)%strs.length);\
    newLoc=loc.href.split(strs[i]).join(strs[j]);\
    loc.assign(newLoc);\
  }\
}\
})();';

    // generate link to copy.
    var output = document.querySelector('output');
    var a = output.querySelector('a');
    a.href = bookmarklet;
    var title = document.getElementById('bookmark-title').value;
    if (title.length == 0) {
        title = "Rotate!";
    };
    a.innerHTML = title;
    output.removeAttribute('hidden');
}

function addField(e) {
    var input = document.createElement('input');
    input.className = "needle";
    input.placeholder = "another string";
    e.target.parentNode.insertBefore(input, e.target);
}
document.querySelector('form').addEventListener('submit', generateBookmarklet, false);
document.querySelector('button').addEventListener('click', addField, false);
</script>
